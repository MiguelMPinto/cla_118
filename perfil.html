<!DOCTYPE html>
<html lang="pt">

<head>
  <meta charset="UTF-8">
  <title>Perfil do Caminheiro</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <nav>
    <div class="nav-left">
      <a href="index.html">Caminheiros</a>
      <a href="trilhos.html">Trilhos</a>
    </div>

    <img src="img/agrup_logo.jpg" class="nav-logo">
  </nav>


  <div class="page">
    <h1 id="nome"></h1>

    <div class="trilhos-card">
      <h2>Trilhos</h2>
      <div id="trilhos"></div>

      <button id="btnStats" class="stats-btn">Ver estat√≠sticas</button>

      <div id="statsPanel" class="stats-panel hidden"></div>
    </div>



    <div id="areas"></div>





  </div>

  <script type="module" src="script.js"></script>

  <script type="module">
    import { loadJSON, parseSheetDate } from "./script.js";
    const AREAS = [

      /* ========= F√çSICO ========= */
      {
        id: "fisico",
        titulo: "Bem-estar F√≠sico",
        css: "area-f",
        objetivos: [
          { campo: "F1", codigo: "F1", texto: "Praticar actividade f√≠sica que promova o desenvolvimento e manuten√ß√£o da agilidade, flexibilidade e destreza" },
          { campo: "F2", codigo: "F2", texto: "Conhecer e aceitar o desenvolvimento e amadurecimento do seu corpo com naturalidade" },
          { campo: "F3", codigo: "F3", texto: "Conhecer as caracter√≠sticas fisiol√≥gicas do corpo masculino e feminino" },
          { campo: "F4", codigo: "F4", texto: "Cultivar um estilo de vida saud√°vel e equilibrado (alimenta√ß√£o, actividade f√≠sica e repouso)" },
          { campo: "F5", codigo: "F5", texto: "Cuidar e valorizar o seu corpo de acordo com padr√µes de sa√∫de, revelando aprumo" },
          { campo: "F6", codigo: "F6", texto: "Identificar e evitar comportamentos de risco relacionados com seguran√ßa f√≠sica e consumo de subst√¢ncias" }
        ]
      },

      /* ========= AFETIVO ========= */
      {
        id: "afetivo",
        titulo: "Afectivo / Emocional",
        css: "area-a",
        objetivos: [
          { campo: "A1", codigo: "A1", texto: "Valorizar e demonstrar sensibilidade nas suas rela√ß√µes afectivas" },
          { campo: "A2", codigo: "A2", texto: "Respeitar v√°rias sensibilidades est√©ticas e art√≠sticas com sentido cr√≠tico" },
          { campo: "A3", codigo: "A3", texto: "Assumir a pr√≥pria sexualidade de forma respons√°vel" },
          { campo: "A4", codigo: "A4", texto: "Identificar, compreender e expressar emo√ß√µes tendo em conta os outros" },
          { campo: "A5", codigo: "A5", texto: "Reconhecer e aceitar a sua personalidade mantendo atitude de aperfei√ßoamento" },
          { campo: "A6", codigo: "A6", texto: "Valorizar capacidades, superar limita√ß√µes e manter atitude positiva" }
        ]
      },

      /* ========= CAR√ÅTER ========= */
      {
        id: "caracter",
        titulo: "Car√°cter / Autonomia / Responsabilidade",
        css: "area-c",
        objetivos: [
          { campo: "C1", codigo: "C1", texto: "Possuir e desenvolver um quadro de valores fruto de op√ß√£o consciente" },
          { campo: "C2", codigo: "C2", texto: "Formular e construir op√ß√µes, assumindo-as com clareza" },
          { campo: "C3", codigo: "C3", texto: "Ser respons√°vel pelo seu desenvolvimento e definir objectivos pessoais" },
          { campo: "C4", codigo: "C4", texto: "Demonstrar empenho e assumir responsabilidades, estabelecendo prioridades" },
          { campo: "C5", codigo: "C5", texto: "Demonstrar perseveran√ßa nas dificuldades com optimismo" },
          { campo: "C6", codigo: "C6", texto: "Ser consequente com as op√ß√µes que toma" },
          { campo: "C7", codigo: "C7", texto: "Ser consistente e convicto na defesa das suas ideias e valores" },
          { campo: "C8", codigo: "C8", texto: "Dar testemunho agindo coerentemente com os seus valores" }
        ]
      },

      /* ========= ESPIRITUAL ========= */
      {
        id: "espiritual",
        titulo: "Espiritual / Descoberta / Servi√ßo",
        css: "area-e",
        objetivos: [
          { campo: "E1", codigo: "E1", texto: "Conhecer como Deus se revelou √† humanidade (Hist√≥ria da Salva√ß√£o)" },
          { campo: "E2", codigo: "E2", texto: "Conhecer profundamente a mensagem e proposta de Jesus Cristo" },
          { campo: "E3", codigo: "E3", texto: "Reconhecer a perten√ßa √† Igreja como sinal de Deus no mundo" },
          { campo: "E4", codigo: "E4", texto: "Aprofundar ora√ß√£o pessoal e participa√ß√£o activa na comunidade" },
          { campo: "E5", codigo: "E5", texto: "Integrar na vida os valores do Evangelho" },
          { campo: "E6", codigo: "E6", texto: "Conhecer as principais religi√µes valorizando a identidade da Igreja Cat√≥lica" },
          { campo: "E7", codigo: "E7", texto: "Testemunhar que Deus dignifica a vida humana e a natureza" },
          { campo: "E8", codigo: "E8", texto: "Viver o compromisso crist√£o como miss√£o no mundo" }
        ]
      },

      /* ========= INTELECTUAL ========= */
      {
        id: "intelectual",
        titulo: "Intelectual",
        css: "area-i",
        objetivos: [
          { campo: "I1", codigo: "I1", texto: "Procurar activamente novos saberes e viv√™ncias" },
          { campo: "I2", codigo: "I2", texto: "Usar correctamente recolha e an√°lise de informa√ß√£o" },
          { campo: "I3", codigo: "I3", texto: "Definir e manter atualizado um itiner√°rio de forma√ß√£o" },
          { campo: "I4", codigo: "I4", texto: "Adaptar-se e superar novas situa√ß√µes" },
          { campo: "I5", codigo: "I5", texto: "Analisar problemas criticamente e propor solu√ß√µes" },
          { campo: "I6", codigo: "I6", texto: "Criar novas ideias e obras com esp√≠rito inovador" },
          { campo: "I7", codigo: "I7", texto: "Expressar ideias de forma l√≥gica e criativa" }
        ]
      },

      /* ========= SOCIAL ========= */
      {
        id: "social",
        titulo: "Social / Cidadania / Coopera√ß√£o",
        css: "area-s",
        objetivos: [
          { campo: "S1", codigo: "S1", texto: "Conhecer e exercer direitos e deveres de cidad√£o" },
          { campo: "S2", codigo: "S2", texto: "Participar ativamente nos espa√ßos sociais onde se insere" },
          { campo: "S3", codigo: "S3", texto: "Respeitar regras democr√°ticas e decis√µes colectivas" },
          { campo: "S4", codigo: "S4", texto: "Assumir servi√ßo √† sociedade construindo futuro" },
          { campo: "S5", codigo: "S5", texto: "Comunicar com empatia e toler√¢ncia" },
          { campo: "S6", codigo: "S6", texto: "Trabalhar em equipa contribuindo para o sucesso colectivo" },
          { campo: "S7", codigo: "S7", texto: "Assumir pap√©is de lideran√ßa equilibrada" }
        ]
      }

    ];



    function renderArea(areaConfig, objetivosMap) {
      let html = `<div class="area-card ${areaConfig.css}">
      <h2>${areaConfig.id.charAt(0).toUpperCase() + areaConfig.id.slice(1)}</h2>

      <ul>
  `;

      areaConfig.objetivos.forEach(item => {
        const estado = objetivosMap[item.codigo] || "Sem dados";

        let classe = "mid";
        if (estado === "Validado") classe = "ok";
        else if (estado === "Por Realizar") classe = "not";

        html += `
      <li>
        <strong>${item.codigo}</strong> ‚Äì ${item.texto}<br>
        <span class="tag ${classe}">${estado}</span>
      </li>
    `;
      });

      html += `
      </ul>
    </div>
  `;

      return html;
    }

    function gerarEstatisticas(objetivosMap) {
      const todos = [];

      AREAS.forEach(area => {
        area.objetivos.forEach(obj => {
          const raw = objetivosMap[obj.codigo] ?? "Sem dados";
          const estado =
            typeof raw === "string" ? raw.trim() : raw; // tira espa√ßos extras

          todos.push({
            codigo: obj.codigo,
            texto: obj.texto,
            estado
          });
        });
      });

      const total = todos.length;
      const completos = todos.filter(x => x.estado === "Validado").length;
      const porFazer = todos.filter(x => x.estado === "Por Realizar");

      let listaHTML = "";

      if (porFazer.length === 0) {
        listaHTML = "<p>Tudo conclu√≠do üéâ</p>";
      } else {
        listaHTML += "<ul class='stats-list'>";
        porFazer.forEach(x => {
          listaHTML += `<li><strong>${x.codigo}</strong> ‚Äì ${x.texto}</li>`;
        });
        listaHTML += "</ul>";
      }

      return `
  <div class="stats-header">
    <div class="stat-box total">Total<br><span>${total}</span></div>
    <div class="stat-box done">Conclu√≠dos<br><span>${completos}</span></div>
    <div class="stat-box pending">Por Fazer<br><span>${total - completos}</span></div>
  </div>

  <h3>Faltam:</h3>
  ${listaHTML}
`;
    }




    async function main() {

      // 1Ô∏è‚É£ Ler nome da URL
      const params = new URLSearchParams(window.location.search);
      const nome = params.get("nome");

      document.getElementById("nome").textContent = nome;

      // 2Ô∏è‚É£ Carregar JSON
      const data = await loadJSON();
      const lista = data.Caminheiros;

      // 3Ô∏è‚É£ Encontrar a pessoa
      const pessoa = lista.find(p => p["Nome"] === nome);


      if (!pessoa) {
        document.getElementById("trilhos").innerHTML = "<p>N√£o encontrado.</p>";
        return;
      }

      // üî• MAPEAR CAMPOS ‚Üí F1, A3, C7 ...
      const objetivosMap = {};

      Object.entries(pessoa).forEach(([key, value]) => {
        const m = key.match(/([FAECIS]\d+)$/);   // apanha A1 F3 C7 etc
        if (m) objetivosMap[m[1]] = value;
      });


      // 4Ô∏è‚É£ Mostrar trilhos
      const trilhosHTML = `
  <p><strong>Caminho:</strong> ${parseSheetDate(pessoa["#NAME? Caminho"]) || "-"}</p>
  <p><strong>Comunidade:</strong> ${parseSheetDate(pessoa["#NAME? Comunidade"]) || "-"}</p>
  <p><strong>Servi√ßo:</strong> ${parseSheetDate(pessoa["#NAME? Servi√ßo"]) || "-"}</p>
  <p><strong>Partida:</strong> ${parseSheetDate(pessoa["#NAME? Partida"]) || "-"}</p>
`;


      document.getElementById("trilhos").innerHTML = trilhosHTML;

      // 5Ô∏è‚É£ Renderizar TODAS as √°reas automaticamente
      let areasHTML = "";

      AREAS.forEach(area => {
        areasHTML += renderArea(area, objetivosMap);
      });

      document.getElementById("areas").innerHTML = areasHTML;

      // === Estat√≠sticas ===
      const btn = document.getElementById("btnStats");
      const panel = document.getElementById("statsPanel");

      btn.onclick = () => {
        panel.classList.toggle("hidden");

        if (!panel.classList.contains("hidden")) {
          panel.innerHTML = gerarEstatisticas(objetivosMap);
          btn.textContent = "Esconder estat√≠sticas";
        } else {
          btn.textContent = "Ver estat√≠sticas";
        }
      };


    }


    main();

  </script>

</body>

</html>